---
title: 09_Javaé›†åˆæ¡†æ¶æ ¸å¿ƒçŸ¥è¯†ç‚¹ä¸å…¸å‹é¢è¯•é¢˜è§£æ
createTime: 2025/11/17 23:04:47
permalink: /language/dk9cxyez/
---
## çŸ¥è¯†ä½“ç³»æ¦‚è§ˆ

```mermaid
---
config:
  theme: neutral
  look: handDrawn
  layout: elk
  class:
    hideEmptyMembersBox: true
---
flowchart LR
    A["Javaé›†åˆæ¡†æ¶"] --> B1["æ¥å£å±‚æ¬¡"] & B2["å®ç°ç±»"] & B3["å·¥å…·ç±»"] & B4["å¹¶å‘é›†åˆ"] & B5["æ€§èƒ½ä¼˜åŒ–"]
    B1 --> C1["Collection"] & C2["Map"] & C3["Iterator/Spliterator"]
    C1 --> D1["List"] & D2["Set"] & D3["Queue/Deque"]
    D1 --> E1["ArrayList"] & E2["LinkedList"] & E3["Vector"]
    D2 --> F1["HashSet"] & F2["LinkedHashSet"] & F3["TreeSet"]
    D3 --> G1["ArrayDeque"] & G2["PriorityQueue"] & G3["BlockingQueue"]
    C2 --> H1["HashMap"] & H2["LinkedHashMap"] & H3["TreeMap"] & H4["Hashtable"] & H5["ConcurrentHashMap"]
    B2 --> I1["çº¿ç¨‹å®‰å…¨å®ç°"] & I2["éçº¿ç¨‹å®‰å…¨å®ç°"]
    B3 --> J1["Collections"] & J2["Arrays"] & J3["Stream API"]
    B4 --> K1["ConcurrentHashMap"] & K2["CopyOnWriteArrayList"] & K3["BlockingQueueå®ç°"]
    B5 --> L1["é€‰æ‹©åˆé€‚é›†åˆ"] & L2["é¿å…æ€§èƒ½é™·é˜±"] & L3["å¹¶å‘å®‰å…¨"]

```

## é«˜é¢‘é¢è¯•é¢˜åˆ†ç±»

### åŸºç¡€æ¦‚å¿µç±»

#### `ArrayList`ã€`LinkedList`ã€`Vector`çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯

**æ ¸å¿ƒè¦ç‚¹**ï¼š

+ **åº•å±‚ç»“æ„**ï¼š`ArrayList`åŸºäºåŠ¨æ€æ•°ç»„ï¼Œ`LinkedList`åŸºäºåŒå‘é“¾è¡¨ï¼Œ`Vector`åŸºäºåŠ¨æ€æ•°ç»„
+ **çº¿ç¨‹å®‰å…¨æ€§**ï¼š`Vector`çº¿ç¨‹å®‰å…¨ï¼ˆsynchronizedï¼‰ï¼Œ`ArrayList`å’Œ`LinkedList`éçº¿ç¨‹å®‰å…¨
+ **æ€§èƒ½ç‰¹ç‚¹**ï¼š
  + `ArrayList`ï¼šéšæœºè®¿é—®å¿«ï¼ˆO(1)ï¼‰ï¼Œæ’å…¥åˆ é™¤æ…¢ï¼ˆO(n)ï¼‰
  + `LinkedList`ï¼šéšæœºè®¿é—®æ…¢ï¼ˆO(n)ï¼‰ï¼Œæ’å…¥åˆ é™¤å¿«ï¼ˆO(1)ï¼‰
  + `Vector`ï¼šæ€§èƒ½è¾ƒä½ï¼Œå·²è¢«å¹¶å‘é›†åˆæ›¿ä»£ï¼ˆå¦‚`ConcurrentHashMap`ã€`CopyOnWriteArrayList`ï¼‰
+ **å†…å­˜å ç”¨**ï¼š`ArrayList`å†…å­˜è¿ç»­ï¼Œ`LinkedList`æ¯ä¸ªèŠ‚ç‚¹æœ‰å‰åæŒ‡é’ˆå¼€é”€
+ **æ‰©å®¹æœºåˆ¶**ï¼š`ArrayList`æ‰©å®¹ä¸º1.5å€ï¼Œ`Vector`æ‰©å®¹ä¸º2å€

**ä½¿ç”¨åœºæ™¯**ï¼š

+ `ArrayList`ï¼šè¯»å¤šå†™å°‘ï¼Œéœ€è¦é¢‘ç¹éšæœºè®¿é—®
+ `LinkedList`ï¼šå†™å¤šè¯»å°‘ï¼Œé¢‘ç¹æ’å…¥åˆ é™¤ï¼Œæˆ–éœ€è¦ä½œä¸ºé˜Ÿåˆ—/æ ˆä½¿ç”¨
+ `Vector`ï¼šå‡ ä¹ä¸æ¨èä½¿ç”¨ï¼Œå¯ç”¨`CopyOnWriteArrayList`æˆ–`Collections.synchronizedList`æ›¿ä»£

#### `HashMap`çš„å·¥ä½œåŸç†å’Œå®ç°ç»†èŠ‚

**æ ¸å¿ƒè¦ç‚¹**ï¼š

+ **å­˜å‚¨ç»“æ„**ï¼š`JDK 8+`é‡‡ç”¨æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ç»“æ„
+ **å“ˆå¸Œç®—æ³•**ï¼š`key.hashCode()` â†’ æ‰°åŠ¨å‡½æ•° â†’ å–æ¨¡å®šä½æ¡¶
+ **å†²çªè§£å†³**ï¼šé“¾åœ°å€æ³•ï¼ˆé“¾è¡¨+çº¢é»‘æ ‘ï¼‰
+ **çº¢é»‘æ ‘è½¬æ¢**ï¼šé“¾è¡¨é•¿åº¦>=`8`ä¸”æ•°ç»„é•¿åº¦>=`64`æ—¶è½¬æ¢ä¸ºçº¢é»‘æ ‘
+ **æ‰©å®¹æœºåˆ¶**ï¼š
  + è§¦å‘æ¡ä»¶ï¼šå…ƒç´ æ•°é‡ > æ•°ç»„é•¿åº¦ * è´Ÿè½½å› å­(é»˜è®¤`0.75`)
  + æ‰©å®¹å¤§å°ï¼šåŸå®¹é‡çš„`2`å€
  + `JDK 8+`ä¼˜åŒ–ï¼šæ‰©å®¹æ—¶æ— éœ€é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œåªéœ€åˆ¤æ–­æœ€é«˜ä½æ˜¯å¦ä¸º1ï¼Œå†³å®šæ˜¯å¦è¿ç§»åˆ°æ–°æ¡¶
+ **çº¿ç¨‹å®‰å…¨æ€§**ï¼šéçº¿ç¨‹å®‰å…¨ï¼Œå¯èƒ½å¯¼è‡´æ­»å¾ªç¯ã€æ•°æ®ä¸¢å¤±ç­‰é—®é¢˜
+ `key`**å…è®¸ä¸º**`null`ï¼šæ”¾åœ¨æ•°ç»„ç´¢å¼•`0`çš„ä½ç½®

**JDK 7 vs JDK 8çš„ä¸»è¦åŒºåˆ«**ï¼š

+ **å­˜å‚¨ç»“æ„**ï¼š`JDK 7`ç”¨æ•°ç»„+é“¾è¡¨ï¼Œ`JDK 8`ç”¨æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘
+ **é“¾è¡¨æ’å…¥**ï¼š`JDK 7`ç”¨å¤´æ’æ³•ï¼Œ`JDK 8`ç”¨å°¾æ’æ³•
+ **æ‰©å®¹æœºåˆ¶**ï¼š`JDK 8`ä¼˜åŒ–äº†é‡æ–°å“ˆå¸Œçš„è¿‡ç¨‹ï¼Œæ— éœ€é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œåªéœ€åˆ¤æ–­æœ€é«˜ä½æ˜¯å¦ä¸º1ï¼Œå†³å®šæ˜¯å¦è¿ç§»åˆ°æ–°æ¡¶
+ **æ€§èƒ½**ï¼š`JDK 8`åœ¨å“ˆå¸Œå†²çªä¸¥é‡æ—¶æ€§èƒ½æ›´å¥½

#### `HashSet`ã€`TreeSet`ã€`LinkedHashSet`çš„åŒºåˆ«ä¸ä½¿ç”¨åœºæ™¯

**æ ¸å¿ƒè¦ç‚¹**ï¼š

+ **åº•å±‚å®ç°**ï¼š`HashSet`åŸºäº`HashMap`ï¼Œ`TreeSet`åŸºäº`TreeMap`ï¼Œ`LinkedHashSet`åŸºäº`LinkedHashMap`
+ **æ’åºç‰¹æ€§**ï¼š`HashSet`æ— åºï¼Œ`TreeSet`æœ‰åºï¼ˆè‡ªç„¶æ’åºæˆ–è‡ªå®šä¹‰æ’åºï¼‰ï¼Œ`LinkedHashSet`ç»´æŠ¤æ’å…¥é¡ºåº
+ **æ€§èƒ½ç‰¹ç‚¹**ï¼š
  + `HashSet`ï¼šæ·»åŠ ã€æŸ¥è¯¢ã€åˆ é™¤éƒ½æ˜¯`O(1)`
  + `TreeSet`ï¼šæ·»åŠ ã€æŸ¥è¯¢ã€åˆ é™¤éƒ½æ˜¯`O(log n)`
  + `LinkedHashSet`ï¼šç•¥æ…¢äº`HashSet`ï¼Œä½†æ”¯æŒæ’å…¥é¡ºåºéå†
+ **nullå€¼**ï¼š`HashSet`å’Œ`LinkedHashSet`å…è®¸ä¸€ä¸ª`null`ï¼Œ`TreeSet`ä¸å…è®¸`null`
+ **ä½¿ç”¨åœºæ™¯**ï¼š
  + `HashSet`ï¼šåªéœ€å»é‡ï¼Œä¸å…³å¿ƒé¡ºåº
  + `TreeSet`ï¼šéœ€è¦æ’åºæˆ–èŒƒå›´æŸ¥è¯¢
  + `LinkedHashSet`ï¼šéœ€è¦å»é‡å¹¶ä¿æŒæ’å…¥é¡ºåº

### æ€§èƒ½ä¼˜åŒ–ç±»

#### é›†åˆç±»çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **åˆå§‹å®¹é‡è®¾ç½®**ï¼šæ ¹æ®é¢„æœŸå…ƒç´ æ•°é‡è®¾ç½®åˆç†çš„åˆå§‹å®¹é‡ï¼Œé¿å…é¢‘ç¹æ‰©å®¹
2. **è´Ÿè½½å› å­è°ƒæ•´**ï¼šæƒè¡¡æ—¶é—´å’Œç©ºé—´æ•ˆç‡ï¼ˆ`HashMap`é»˜è®¤`0.75`ï¼‰
3. **å‡å°‘å“ˆå¸Œå†²çª**ï¼šåˆç†å®ç°`hashCode()`å’Œ`equals()`æ–¹æ³•
4. **é€‰æ‹©åˆé€‚é›†åˆ**ï¼šæ ¹æ®æ“ä½œç‰¹æ€§é€‰æ‹©åˆé€‚çš„é›†åˆå®ç°
5. **æ‰¹é‡æ“ä½œ**ï¼šä½¿ç”¨`addAll()`ç­‰æ‰¹é‡æ–¹æ³•æ›¿ä»£å¾ªç¯æ·»åŠ 
6. **é¿å…è‡ªåŠ¨è£…ç®±**ï¼šä¼˜å…ˆä½¿ç”¨åŸå§‹ç±»å‹é›†åˆï¼ˆå¦‚`IntArrayList`ï¼‰ï¼Œé¿å…è‡ªåŠ¨è£…ç®±æ‹†ç®±æ“ä½œ
7. **åŠæ—¶æ¸…ç†**ï¼šä¸å†ä½¿ç”¨çš„é›†åˆåº”åŠæ—¶ç½®ä¸º`null`ï¼Œå¸®åŠ©`GC`å›æ”¶å†…å­˜
8. **è¿­ä»£å™¨ä½¿ç”¨**ï¼šä¼˜å…ˆä½¿ç”¨è¿­ä»£å™¨éå†ï¼Œé¿å…ä½¿ç”¨éšæœºè®¿é—®

#### å¹¶å‘é›†åˆçš„é€‰æ‹©ä¸ä½¿ç”¨

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **è¯»å¤šå†™å°‘åœºæ™¯**ï¼šä½¿ç”¨`CopyOnWriteArrayList`/`CopyOnWriteArraySet`
2. **é«˜é¢‘è¯»å†™åœºæ™¯**ï¼šä½¿ç”¨`ConcurrentHashMap`
3. **æœ‰åºå¹¶å‘Map**ï¼šä½¿ç”¨`ConcurrentSkipListMap`
4. **ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼**ï¼šä½¿ç”¨`BlockingQueue`å®ç°
5. **é¿å…ä½¿ç”¨**ï¼šå°½é‡é¿å…ä½¿ç”¨`Hashtable`å’Œ`Vector`ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ€§èƒ½è¾ƒä½
6. **ç»†ç²’åº¦é”**ï¼šå¹¶å‘é›†åˆé€šå¸¸ä½¿ç”¨ç»†ç²’åº¦é”æˆ–æ— é”ç®—æ³•ï¼Œæ€§èƒ½ä¼˜äº`Collections.synchronizedXxx()`
7. **å¼±ä¸€è‡´æ€§**ï¼šç†è§£å¹¶å‘é›†åˆè¿­ä»£å™¨çš„å¼±ä¸€è‡´æ€§è¯­ä¹‰

### æºç ç†è§£ç±»

#### `equals()`å’Œ`hashCode()`æ–¹æ³•çš„å¥‘çº¦åŠæ­£ç¡®å®ç°

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **å¥‘çº¦å…³ç³»**ï¼š
    + å¦‚æœä¸¤ä¸ªå¯¹è±¡`equals`ï¼Œåˆ™å®ƒä»¬çš„`hashCode`å¿…é¡»ç›¸ç­‰
    + å¦‚æœä¸¤ä¸ªå¯¹è±¡`hashCode`ä¸ç›¸ç­‰ï¼Œåˆ™å®ƒä»¬ä¸€å®šä¸`equals`
    + åŒä¸€å¯¹è±¡å¤šæ¬¡è°ƒç”¨`hashCode()`åº”è¿”å›ç›¸åŒå€¼ï¼ˆåªè¦å¯¹è±¡æœªè¢«ä¿®æ”¹ï¼‰
2. **å¸¸è§é”™è¯¯**ï¼š
    + åªé‡å†™`equals()`è€Œä¸é‡å†™`hashCode()`
    + `hashCode()`å®ç°è¿‡äºç®€å•ï¼Œå¯¼è‡´å¤§é‡å“ˆå¸Œå†²çª
    + `equals()`å®ç°è¿åè‡ªåæ€§ã€å¯¹ç§°æ€§ã€ä¼ é€’æ€§
3. **æ­£ç¡®å®ç°åŸåˆ™**ï¼š
    + `equals()`ï¼šè€ƒè™‘æ‰€æœ‰å…³é”®å±æ€§ï¼Œå¤„ç†`null`å’Œç±»å‹æ£€æŸ¥
    + `hashCode()`ï¼šç»“åˆæ‰€æœ‰å…³é”®å±æ€§ï¼Œä½¿ç”¨è´¨æ•°ä¹˜ç§¯æ³•å‡å°‘å†²çªï¼ˆå¦‚`31 * hash + field`ï¼‰

**ç¤ºä¾‹ä»£ç **ï¼š

```java
public class Employee {
    private String id;
    private String name;
    private int age;
    
    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        Employee employee = (Employee) o;
        return age == employee.age && 
               Objects.equals(id, employee.id) && 
               Objects.equals(name, employee.name);
    }
    
    @Override
    public int hashCode() {
        return Objects.hash(id, name, age);
    }
}
```

#### `HashMap`çš„æ‰©å®¹æœºåˆ¶ä¸çº¿ç¨‹å®‰å…¨é—®é¢˜

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **æ‰©å®¹è¿‡ç¨‹**ï¼š
    + åˆ›å»ºæ–°çš„æ›´å¤§çš„æ•°ç»„ï¼ˆåŸå®¹é‡çš„`2`å€ï¼‰
    + é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®
    + å°†å…ƒç´ å¤åˆ¶åˆ°æ–°æ•°ç»„
2. **JDK 7çº¿ç¨‹å®‰å…¨é—®é¢˜**ï¼š
    + å¤šçº¿ç¨‹å¹¶å‘æ‰©å®¹å¯èƒ½å¯¼è‡´é“¾è¡¨æˆç¯
    + å¯¼è‡´`get()`æ“ä½œè¿›å…¥æ­»å¾ªç¯
    + åŸå› ï¼šå¤´æ’æ³•+å¤šçº¿ç¨‹å¹¶å‘ä¿®æ”¹
3. **JDK 8æ”¹è¿›**ï¼š
    + ä½¿ç”¨å°¾æ’æ³•é¿å…é“¾è¡¨æˆç¯
    + ä½†ä»éçº¿ç¨‹å®‰å…¨ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±
4. **çº¿ç¨‹å®‰å…¨æ›¿ä»£æ–¹æ¡ˆ**ï¼š
    + `ConcurrentHashMap`ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹çš„çº¿ç¨‹å®‰å…¨Mapå®ç°
    + `Collections.synchronizedMap`ï¼šä½å¹¶å‘åœºæ™¯ä¸‹çš„çº¿ç¨‹å®‰å…¨MapåŒ…è£…å™¨
    + `HashTable`ï¼šä¸æ¨èä½¿ç”¨ï¼Œå› ä¸ºå®ƒæ˜¯åŒæ­¥çš„ï¼Œæ€§èƒ½è¾ƒä½

### å®æˆ˜åº”ç”¨ç±»

#### å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **æšä¸¾å•ä¾‹**ï¼šæœ€ç®€å•ä¸”çº¿ç¨‹å®‰å…¨çš„æ–¹å¼
2. **åŒé‡æ£€æŸ¥é”å®š**ï¼šéœ€è¦ä½¿ç”¨`volatile`å…³é”®å­—é˜²æ­¢æŒ‡ä»¤é‡æ’åºå¯¼è‡´çš„çº¿ç¨‹å®‰å…¨é—®é¢˜
3. **é™æ€å†…éƒ¨ç±»**ï¼šåˆ©ç”¨ç±»åŠ è½½æœºåˆ¶ä¿è¯çº¿ç¨‹å®‰å…¨
4. **ä½¿ç”¨**`ConcurrentHashMap`ï¼šå¯ä»¥å®ç°æ³¨å†Œè¡¨å¼çš„å•ä¾‹

`ConcurrentHashMap`**å®ç°ç¤ºä¾‹**ï¼š

```java
public class ConcurrentSingletonRegistry {
    private static final ConcurrentHashMap<String, Object> INSTANCES = new ConcurrentHashMap<>();
    
    public static <T> T getInstance(String key, Supplier<T> supplier) {
        return (T) INSTANCES.computeIfAbsent(key, k -> supplier.get());
    }
}
```

#### è®¾è®¡ä¸€ä¸ª`LRU`ç¼“å­˜

**æ ¸å¿ƒè¦ç‚¹**ï¼š

1. **æ•°æ®ç»“æ„é€‰æ‹©**ï¼š`LinkedHashMap` + é‡å†™`removeEldestEntry()`æ–¹æ³•
2. **æ‰‹åŠ¨å®ç°**ï¼š`HashMap` + åŒå‘é“¾è¡¨
3. **å¹¶å‘å®ç°**ï¼šä½¿ç”¨`ConcurrentHashMap` + å¹¶å‘å®‰å…¨çš„é“¾è¡¨
4. **æ€§èƒ½è€ƒé‡**ï¼š
    + `get`æ“ä½œï¼šO(1)æ—¶é—´å¤æ‚åº¦
    + `put`æ“ä½œï¼šO(1)æ—¶é—´å¤æ‚åº¦
    + éœ€è¦ç»´æŠ¤è®¿é—®é¡ºåº

**LinkedHashMapå®ç°ç¤ºä¾‹**ï¼š

```java
public class LRUCache<K, V> extends LinkedHashMap<K, V> {
    private final int capacity;
    
    public LRUCache(int capacity) {
        super(capacity, 0.75f, true);
        this.capacity = capacity;
    }
    
    @Override
    protected boolean removeEldestEntry(Map.Entry<K, V> eldest) {
        return size() > capacity;
    }
}
```

## é¢è¯•å›ç­”æ¡†æ¶

### ç›´æ¥å›ç­”æ³•

é€‚ç”¨äºç®€å•æ¦‚å¿µæ€§é—®é¢˜ï¼Œå¦‚é›†åˆç±»çš„åŸºæœ¬åŠŸèƒ½ã€ä½¿ç”¨åœºæ™¯ç­‰ã€‚

**ç¤ºä¾‹**ï¼š  
é—®ï¼š`ArrayList`å’Œ`LinkedList`çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

ç­”ï¼š`ArrayList`å’Œ`LinkedList`çš„ä¸»è¦åŒºåˆ«ä½“ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š

1. **åº•å±‚æ•°æ®ç»“æ„ä¸åŒ**ï¼š`ArrayList`åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œè€Œ`LinkedList`åŸºäºåŒå‘é“¾è¡¨å®ç°ã€‚
2. **æ€§èƒ½ç‰¹ç‚¹ä¸åŒ**ï¼š`ArrayList`çš„éšæœºè®¿é—®æ€§èƒ½ä¼˜å¼‚ï¼ˆO(1)æ—¶é—´å¤æ‚åº¦ï¼‰ï¼Œä½†æ’å…¥åˆ é™¤æ“ä½œè¾ƒæ…¢ï¼ˆç‰¹åˆ«æ˜¯ä¸­é—´ä½ç½®ï¼ŒO(n)æ—¶é—´å¤æ‚åº¦ï¼‰ï¼›`LinkedList`çš„éšæœºè®¿é—®æ€§èƒ½è¾ƒå·®ï¼ˆO(n)æ—¶é—´å¤æ‚åº¦ï¼‰ï¼Œä½†æ’å…¥åˆ é™¤æ“ä½œå¿«é€Ÿï¼ˆO(1)æ—¶é—´å¤æ‚åº¦ï¼‰ã€‚
3. **å†…å­˜å ç”¨ä¸åŒ**ï¼š`ArrayList`å†…å­˜å ç”¨ç›¸å¯¹è¿ç»­ç´§å‡‘ï¼Œè€Œ`LinkedList`æ¯ä¸ªèŠ‚ç‚¹éœ€è¦é¢å¤–å­˜å‚¨å‰åå¼•ç”¨ï¼Œå†…å­˜å¼€é”€æ›´å¤§ã€‚

åŸºäºè¿™äº›å·®å¼‚ï¼Œ`ArrayList`æ›´é€‚åˆè¯»å¤šå†™å°‘ã€éœ€è¦é¢‘ç¹éšæœºè®¿é—®çš„åœºæ™¯ï¼Œè€Œ`LinkedList`æ›´é€‚åˆå†™å¤šè¯»å°‘ã€é¢‘ç¹æ’å…¥åˆ é™¤çš„åœºæ™¯ã€‚

### åŸç†é˜è¿°æ³•

é€‚ç”¨äºéœ€è¦æ·±å…¥è§£é‡Šå·¥ä½œåŸç†çš„é—®é¢˜ï¼Œå¦‚`HashMap`çš„å®ç°æœºåˆ¶ã€å¹¶å‘é›†åˆçš„çº¿ç¨‹å®‰å…¨ç­–ç•¥ç­‰ã€‚

**ç¤ºä¾‹**ï¼š  
é—®ï¼šè¯·è¯¦ç»†è§£é‡Š`HashMap`çš„å·¥ä½œåŸç†ã€‚

ç­”ï¼šHashMapåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œé€šè¿‡é”®å€¼å¯¹å­˜å‚¨æ•°æ®ã€‚å…¶æ ¸å¿ƒå·¥ä½œåŸç†åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **å­˜å‚¨ç»“æ„**ï¼š`JDK 8`åŠä»¥ä¸Šç‰ˆæœ¬é‡‡ç”¨æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘çš„æ··åˆç»“æ„ã€‚å½“é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤`8`ï¼‰ä¸”æ•°ç»„é•¿åº¦å¤§äºç­‰äº64æ—¶ï¼Œä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚
2. **å“ˆå¸Œç®—æ³•**ï¼š`HashMap`ä½¿ç”¨`hashCode()`æ–¹æ³•è·å–é”®çš„å“ˆå¸Œç ï¼Œç„¶åé€šè¿‡æ‰°åŠ¨å‡½æ•°è¿›è¡Œå¤„ç†ï¼Œæœ€åå¯¹æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ã€‚
3. **å†²çªè§£å†³**ï¼šå½“å¤šä¸ªé”®æ˜ å°„åˆ°åŒä¸€æ•°ç»„ä½ç½®æ—¶ï¼Œä½¿ç”¨é“¾åœ°å€æ³•è§£å†³å†²çªï¼Œå³å°†è¿™äº›é”®å€¼å¯¹ä»¥é“¾è¡¨å½¢å¼å­˜å‚¨ã€‚
4. **æ‰©å®¹æœºåˆ¶**ï¼šå½“å…ƒç´ æ•°é‡è¶…è¿‡æ•°ç»„é•¿åº¦ä¹˜ä»¥è´Ÿè½½å› å­ï¼ˆé»˜è®¤`0.75`ï¼‰æ—¶ï¼Œ`HashMap`ä¼šè¿›è¡Œæ‰©å®¹ï¼Œå°†æ•°ç»„å¤§å°æ‰©å¤§ä¸ºåŸæ¥çš„ä¸¤å€ï¼Œå¹¶é‡æ–°è®¡ç®—æ‰€æœ‰å…ƒç´ çš„ä½ç½®ã€‚
5. **çº¿ç¨‹å®‰å…¨æ€§**ï¼š`HashMap`ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½å¯¼è‡´é“¾è¡¨æˆç¯ã€æ•°æ®ä¸¢å¤±ç­‰é—®é¢˜ã€‚

### ä»£ç ç¤ºä¾‹æ³•

é€‚ç”¨äºéœ€è¦å±•ç¤ºå…·ä½“å®ç°çš„é—®é¢˜ï¼Œå¦‚`equals`/`hashCode`æ–¹æ³•çš„å®ç°ã€é›†åˆéå†ç­‰ã€‚

**ç¤ºä¾‹**ï¼š  
é—®ï¼šå¦‚ä½•æ­£ç¡®å®ç°`equals`/`hashCode`æ–¹æ³•ï¼Ÿ

ç­”ï¼šæ­£ç¡®å®ç°`equals`/`hashCode`æ–¹æ³•éœ€è¦éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. å¦‚æœä¸¤ä¸ªå¯¹è±¡é€šè¿‡`equals`æ–¹æ³•åˆ¤æ–­ç›¸ç­‰ï¼Œé‚£ä¹ˆå®ƒä»¬çš„`hashCode`æ–¹æ³•å¿…é¡»è¿”å›ç›¸åŒçš„å€¼ã€‚
2. åŒä¸€ä¸ªå¯¹è±¡åœ¨æœªè¢«ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼Œå¤šæ¬¡è°ƒç”¨`hashCode`æ–¹æ³•åº”è¿”å›ç›¸åŒçš„å€¼ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ­£ç¡®å®ç°çš„ç¤ºä¾‹ï¼š

```java
public class User {
    private String username;
    private String email;
    private int age;
    
    @Override
    public boolean equals(Object o) {
        // 1. å¼•ç”¨ç›¸ç­‰æ£€æŸ¥
        if (this == o) return true;
        
        // 2. éç©ºå’Œç±»å‹æ£€æŸ¥
        if (o == null || getClass() != o.getClass()) return false;
        
        // 3. ç±»å‹è½¬æ¢
        User user = (User) o;
        
        // 4. æ¯”è¾ƒå…³é”®å±æ€§
        return age == user.age && 
               Objects.equals(username, user.username) && 
               Objects.equals(email, user.email);
    }
    
    @Override
    public int hashCode() {
        // 5. ç»“åˆæ‰€æœ‰å…³é”®å±æ€§è®¡ç®—å“ˆå¸Œç 
        return Objects.hash(username, email, age);
    }
}
```

è¿™ä¸ªå®ç°ç¡®ä¿äº†`equals`/`hashCode`æ–¹æ³•çš„ä¸€è‡´æ€§ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ­£ç¡®å¤„ç†`null`å€¼å’Œä¸åŒç±»å‹çš„æ¯”è¾ƒã€‚

### åœºæ™¯åˆ†ææ³•

é€‚ç”¨äºéœ€è¦ç»“åˆå®é™…ä¸šåŠ¡åœºæ™¯çš„é—®é¢˜ï¼Œå¦‚é›†åˆé€‰æ‹©ã€æ€§èƒ½ä¼˜åŒ–ç­‰ã€‚

**ç¤ºä¾‹**ï¼š  
é—®ï¼šåœ¨ä¸€ä¸ªéœ€è¦é¢‘ç¹è¯»å–ä½†å¾ˆå°‘ä¿®æ”¹çš„æ•°æ®é›†åˆåœºæ™¯ä¸­ï¼Œåº”è¯¥é€‰æ‹©å“ªç§çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Ÿ

ç­”ï¼šåœ¨è¿™ç§è¯»å¤šå†™å°‘çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä¼šæ¨èä½¿ç”¨`CopyOnWriteArrayList`æˆ–`CopyOnWriteArraySet`ï¼ŒåŸå› å¦‚ä¸‹ï¼š

1. **å®ç°åŸç†**ï¼š`CopyOnWriteArrayList`é‡‡ç”¨å†™æ—¶å¤åˆ¶ç­–ç•¥ï¼Œæ‰€æœ‰å†™æ“ä½œï¼ˆå¦‚`add`ã€`set`ã€`remove`ç­‰ï¼‰éƒ½ä¼šåˆ›å»ºåº•å±‚æ•°ç»„çš„å‰¯æœ¬ï¼Œç„¶åæ›¿æ¢åŸæ•°ç»„ã€‚è€Œè¯»æ“ä½œä¸éœ€è¦ä»»ä½•åŒæ­¥æªæ–½ï¼Œå¯ä»¥å¹¶å‘è¿›è¡Œã€‚
2. **æ€§èƒ½ä¼˜åŠ¿**ï¼š
    + è¯»æ“ä½œå®Œå…¨æ— é”ï¼Œæ€§èƒ½æé«˜ï¼Œéå¸¸é€‚åˆé¢‘ç¹è¯»å–çš„åœºæ™¯
    + è¯»æ“ä½œä¸ä¼šè¢«å†™æ“ä½œé˜»å¡ï¼Œå†™æ“ä½œä¹Ÿä¸ä¼šè¢«è¯»æ“ä½œé˜»å¡
    + è¿­ä»£å™¨åŸºäºåŸæ•°ç»„å¿«ç…§ï¼Œä¸ä¼šæŠ›å‡º`ConcurrentModificationException`
3. **é€‚ç”¨åœºæ™¯**ï¼š
    + é…ç½®åˆ—è¡¨ã€æƒé™åˆ—è¡¨ç­‰å¾ˆå°‘ä¿®æ”¹ä½†é¢‘ç¹è¯»å–çš„æ•°æ®
    + äº‹ä»¶ç›‘å¬å™¨åˆ—è¡¨
    + ç¼“å­˜æ•°æ®ï¼ˆå¦‚æœå†™æ“ä½œä¸é¢‘ç¹ï¼‰
4. **æ³¨æ„äº‹é¡¹**ï¼š
    + å†™æ“ä½œå¼€é”€è¾ƒå¤§ï¼Œéœ€è¦å¤åˆ¶æ•´ä¸ªæ•°ç»„
    + ä¸é€‚åˆå…ƒç´ æ•°é‡å¾ˆå¤§æˆ–å†™æ“ä½œé¢‘ç¹çš„åœºæ™¯
    + å†…å­˜å ç”¨è¾ƒé«˜ï¼Œå¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´ï¼ˆè¯»æ“ä½œå¯èƒ½è¯»å–åˆ°æ—§æ•°æ®ï¼‰

å¦‚æœæ•°æ®é‡å¾ˆå¤§ä¸”å†™æ“ä½œç›¸å¯¹é¢‘ç¹ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨`ConcurrentHashMap`ï¼ˆå¦‚æœæ˜¯`Map`ç»“æ„ï¼‰æˆ–å…¶ä»–å¹¶å‘é›†åˆã€‚

## é«˜é¢‘é¢è¯•é¢˜è¯¦è§£

### `HashMap`çš„å·¥ä½œåŸç†å’Œæ‰©å®¹æœºåˆ¶

**é—®é¢˜**ï¼šè¯·è¯¦ç»†è§£é‡Š`HashMap`çš„å·¥ä½œåŸç†ï¼ŒåŒ…æ‹¬å®ƒçš„æ‰©å®¹æœºåˆ¶å’Œçº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚

**å›ç­”**ï¼š

`HashMap`æ˜¯Javaä¸­å¸¸ç”¨çš„é”®å€¼å¯¹å­˜å‚¨ç»“æ„ï¼Œå…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼š

1. **åŸºæœ¬ç»“æ„**ï¼š
    + JDK 8ä¹‹å‰ï¼šæ•°ç»„+é“¾è¡¨ç»“æ„
    + JDK 8åŠä»¥åï¼šæ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ç»“æ„
2. **å­˜å‚¨è¿‡ç¨‹**ï¼š
    + è®¡ç®—é”®çš„å“ˆå¸Œç ï¼š`key.hashCode()`
    + å¯¹å“ˆå¸Œç è¿›è¡Œæ‰°åŠ¨å¤„ç†ï¼ˆå‡å°‘ç¢°æ’ï¼‰
    + å¯¹æ•°ç»„é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°æ•°ç»„ç´¢å¼•
    + å¦‚æœè¯¥ä½ç½®ä¸ºç©ºï¼Œç›´æ¥æ”¾å…¥ï¼›å¦‚æœä¸ä¸ºç©ºï¼Œé€šè¿‡`equals()`åˆ¤æ–­æ˜¯å¦ç›¸åŒ
    + ç›¸åŒåˆ™è¦†ç›–å€¼ï¼Œä¸åŒåˆ™æ·»åŠ åˆ°é“¾è¡¨æœ«å°¾æˆ–æ ‘èŠ‚ç‚¹
3. **æ‰©å®¹æœºåˆ¶**ï¼š
    + è§¦å‘æ¡ä»¶ï¼šå…ƒç´ æ•°é‡ > æ•°ç»„é•¿åº¦ * è´Ÿè½½å› å­(é»˜è®¤`0.75`)
    + æ‰©å®¹è¿‡ç¨‹ï¼š
        + åˆ›å»ºä¸€ä¸ªæ–°çš„ã€æ›´å¤§çš„æ•°ç»„ï¼ˆåŸå®¹é‡çš„`2`å€ï¼‰
        + é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ çš„ä½ç½®å¹¶è¿ç§»
        + JDK 8ä¼˜åŒ–ï¼šä½¿ç”¨é«˜ä½ä½æ ‡è®°ï¼Œæ— éœ€é‡æ–°è®¡ç®—å“ˆå¸Œå€¼
    + çº¢é»‘æ ‘è½¬æ¢ï¼šå½“é“¾è¡¨é•¿åº¦>=`8`ä¸”æ•°ç»„é•¿åº¦>=`64`æ—¶ï¼Œé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘
4. **çº¿ç¨‹å®‰å…¨é—®é¢˜**ï¼š
    + JDK 7ï¼šå¤šçº¿ç¨‹å¹¶å‘æ‰©å®¹å¯èƒ½å¯¼è‡´é“¾è¡¨æˆç¯ï¼Œå¼•èµ·æ­»å¾ªç¯
    + JDK 8ï¼šè§£å†³äº†é“¾è¡¨æˆç¯é—®é¢˜ï¼Œä½†ä»å­˜åœ¨æ•°æ®è¦†ç›–ç­‰çº¿ç¨‹å®‰å…¨é—®é¢˜
    + çº¿ç¨‹å®‰å…¨æ›¿ä»£ï¼š`ConcurrentHashMap`ã€`Collections.synchronizedMap`ç­‰

### `ArrayList`å’Œ`LinkedList`çš„åŒºåˆ«

**é—®é¢˜**ï¼š`ArrayList`å’Œ`LinkedList`æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥é€‰æ‹©ä½¿ç”¨å®ƒä»¬ï¼Ÿ

**å›ç­”**ï¼š

`ArrayList`å’Œ`LinkedList`æ˜¯`List`æ¥å£çš„ä¸¤ä¸ªä¸»è¦å®ç°ç±»ï¼Œå®ƒä»¬çš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š

1. **åº•å±‚æ•°æ®ç»“æ„**ï¼š
    + `ArrayList`ï¼šåŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œå…ƒç´ å­˜å‚¨åœ¨è¿ç»­çš„å†…å­˜ç©ºé—´
    + `LinkedList`ï¼šåŸºäºåŒå‘é“¾è¡¨å®ç°ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«å‰é©±å¼•ç”¨ã€æ•°æ®å’Œåç»§å¼•ç”¨
2. **æ€§èƒ½ç‰¹ç‚¹**ï¼š
    + `ArrayList`ï¼š
        + éšæœºè®¿é—®æ•ˆç‡é«˜ï¼ˆO(1)æ—¶é—´å¤æ‚åº¦ï¼‰
        + æ’å…¥åˆ é™¤æ•ˆç‡ä½ï¼Œå°¤å…¶æ˜¯ä¸­é—´ä½ç½®ï¼ˆO(n)æ—¶é—´å¤æ‚åº¦ï¼‰
        + æŸ¥æ‰¾æ•ˆç‡ä¾èµ–äºæŸ¥æ‰¾ç®—æ³•
    + `LinkedList`ï¼š
        + éšæœºè®¿é—®æ•ˆç‡ä½ï¼ˆO(n)æ—¶é—´å¤æ‚åº¦ï¼‰
        + æ’å…¥åˆ é™¤æ•ˆç‡é«˜ï¼Œå°¤å…¶æ˜¯é¦–å°¾ä½ç½®ï¼ˆO(1)æ—¶é—´å¤æ‚åº¦ï¼‰
        + åŒå‘éå†æ”¯æŒæ›´çµæ´»ï¼Œå¯åŒæ—¶ä»å‰å¾€åå’Œä»åå¾€å‰éå†
3. **å†…å­˜å¼€é”€**ï¼š
    + `ArrayList`ï¼šå†…å­˜å ç”¨è¾ƒç´§å‡‘ï¼Œä½†å¯èƒ½æœ‰æ‰©å®¹é¢„ç•™ç©ºé—´ï¼Œå¯¼è‡´å†…å­˜æµªè´¹
    + `LinkedList`ï¼šæ¯ä¸ªå…ƒç´ éœ€è¦é¢å¤–å­˜å‚¨å‰åå¼•ç”¨ï¼Œå†…å­˜å¼€é”€è¾ƒå¤§
4. **æ‰©å®¹æœºåˆ¶**ï¼š
    + `ArrayList`ï¼šå½“å®¹é‡ä¸è¶³æ—¶ï¼Œæ‰©å®¹ä¸ºåŸæ¥çš„1.5å€ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æµªè´¹
    + `LinkedList`ï¼šä¸éœ€è¦æ‰©å®¹ï¼ŒåŠ¨æ€åˆ†é…èŠ‚ç‚¹
5. **æ¥å£å®ç°**ï¼š
    + `LinkedList`é¢å¤–å®ç°äº†`Deque`æ¥å£ï¼Œå¯ä½œä¸ºé˜Ÿåˆ—ã€æ ˆä½¿ç”¨
    + `ArrayList`æ²¡æœ‰å®ç°`Deque`æ¥å£ï¼Œä¸èƒ½ç›´æ¥ä½œä¸ºé˜Ÿåˆ—æˆ–æ ˆä½¿ç”¨

ä½¿ç”¨åœºæ™¯é€‰æ‹©ï¼š

+ å½“éœ€è¦é¢‘ç¹éšæœºè®¿é—®å…ƒç´ æ—¶ï¼Œé€‰æ‹©`ArrayList`
+ å½“éœ€è¦é¢‘ç¹åœ¨ä»»æ„ä½ç½®æ’å…¥åˆ é™¤å…ƒç´ æ—¶ï¼Œé€‰æ‹©`LinkedList`
+ å½“å…ƒç´ æ•°é‡å¤§ä¸”éœ€è¦é«˜æ•ˆéå†ï¼ˆç‰¹åˆ«æ˜¯é¡ºåºéå†ï¼‰æ—¶ï¼Œ`ArrayList`æ›´ä¼˜
+ å½“éœ€è¦ä½¿ç”¨é˜Ÿåˆ—æˆ–æ ˆåŠŸèƒ½æ—¶ï¼Œ`LinkedList`æ›´æ–¹ä¾¿
+ å¯¹äºå¤§å¤šæ•°æ—¥å¸¸åº”ç”¨ï¼Œå°¤å…¶æ˜¯è¯»å¤šå†™å°‘çš„åœºæ™¯ï¼Œ`ArrayList`é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©

### `ConcurrentHashMap`çš„çº¿ç¨‹å®‰å…¨å®ç°

**é—®é¢˜**ï¼š`ConcurrentHashMap`æ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„ï¼Ÿå®ƒä¸`Hashtable`å’Œ`Collections.synchronizedMap`æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**å›ç­”**ï¼š

`ConcurrentHashMap`é€šè¿‡ç»†ç²’åº¦é”å’Œæ— é”ç®—æ³•å®ç°é«˜æ•ˆçš„çº¿ç¨‹å®‰å…¨ï¼Œå…¶å®ç°æ–¹å¼åœ¨`JDK 7`å’Œ`JDK 8`ä¸­æœ‰æ˜¾è‘—å·®å¼‚ï¼š

**JDK 7å®ç°**ï¼š

+ é‡‡ç”¨åˆ†æ®µé”ï¼ˆ`Segment`ï¼‰æœºåˆ¶ï¼Œå°†æ•´ä¸ªå“ˆå¸Œè¡¨åˆ†ä¸ºå¤šä¸ª`Segment`
+ æ¯ä¸ª`Segment`ç»§æ‰¿è‡ª`ReentrantLock`ï¼Œå†…éƒ¨ç»´æŠ¤ä¸€ä¸ªå°çš„å“ˆå¸Œè¡¨
+ ä¸åŒ`Segment`çš„æ“ä½œäº’ä¸å½±å“ï¼Œå¯ä»¥å¹¶å‘è¿›è¡Œ
+ è¯»å†™é”åˆ†ç¦»ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»åŒä¸€ä¸ª`Segment`

**JDK 8å®ç°**ï¼š

+ æ”¾å¼ƒäº†åˆ†æ®µé”ï¼Œé‡‡ç”¨`Node`æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘ç»“æ„
+ ä½¿ç”¨`CASæ“ä½œ`å’Œ`synchronizedå…³é”®å­—`ä¿è¯çº¿ç¨‹å®‰å…¨
+ å¯¹é“¾è¡¨å¤´èŠ‚ç‚¹åŠ é”ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ•°ç»„æˆ–`Segment`
+ ä½¿ç”¨`volatile`å…³é”®å­—ç¡®ä¿èŠ‚ç‚¹çš„å¯è§æ€§
+ æ”¯æŒæ›´é«˜çš„å¹¶å‘åº¦ï¼Œç†è®ºä¸Šå¯ä»¥æœ‰æ•°ç»„é•¿åº¦ä¸ªçº¿ç¨‹åŒæ—¶å†™

**ä¸**`Hashtable`**çš„åŒºåˆ«**ï¼š

1. é”ç²’åº¦ï¼š`Hashtable`ä½¿ç”¨å…¨å±€é”ï¼ˆ`synchronized`æ–¹æ³•ï¼‰ï¼Œ`ConcurrentHashMap`ä½¿ç”¨ç»†ç²’åº¦é”
2. å¹¶å‘æ€§èƒ½ï¼š`ConcurrentHashMap`å…è®¸å¤šçº¿ç¨‹å¹¶å‘è®¿é—®ï¼Œ`Hashtable`åªèƒ½ä¸²è¡Œè®¿é—®
3. nullå€¼ï¼š`ConcurrentHashMap`ä¸å…è®¸keyæˆ–valueä¸ºnullï¼Œ`Hashtable`ä¹Ÿä¸å…è®¸
4. è¿­ä»£å™¨ï¼š`ConcurrentHashMap`çš„è¿­ä»£å™¨å¼±ä¸€è‡´æ€§ï¼Œ`Hashtable`çš„è¿­ä»£å™¨å¿«é€Ÿå¤±è´¥

**ä¸**`Collections.synchronizedMap`**çš„åŒºåˆ«**ï¼š

1. é”ç²’åº¦ï¼š`Collections.synchronizedMap`ä½¿ç”¨å•ä¸€é”åŒ…è£…æ•´ä¸ª`Map`ï¼Œ`ConcurrentHashMap`ä½¿ç”¨ç»†ç²’åº¦é”
2. å¹¶å‘æ€§èƒ½ï¼š`ConcurrentHashMap`å¹¶å‘æ€§èƒ½æ›´é«˜
3. è¿­ä»£å™¨ï¼š`Collections.synchronizedMap`çš„è¿­ä»£å™¨å¿«é€Ÿå¤±è´¥ï¼Œ`ConcurrentHashMap`çš„è¿­ä»£å™¨å¼±ä¸€è‡´æ€§
4. é¢å¤–æ“ä½œï¼š`ConcurrentHashMap`æä¾›äº†æ›´å¤šåŸå­æ“ä½œï¼Œå¦‚`putIfAbsent`ã€`replace`ç­‰

æ€»ç»“ï¼š`ConcurrentHashMap`é€šè¿‡ä¼˜åŒ–é”æœºåˆ¶ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶æä¾›äº†æ¥è¿‘`HashMap`çš„æ€§èƒ½ï¼Œæ˜¯é«˜å¹¶å‘åœºæ™¯ä¸‹çš„é¦–é€‰ã€‚

### `fail-fast`å’Œ`fail-safe`æœºåˆ¶çš„åŒºåˆ«

**é—®é¢˜**ï¼šä»€ä¹ˆæ˜¯`fail-fast`å’Œ`fail-safe`æœºåˆ¶ï¼Ÿå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿå“ªäº›é›†åˆå®ç°äº†è¿™äº›æœºåˆ¶ï¼Ÿ

**å›ç­”**ï¼š

`fail-fast`å’Œ`fail-safe`æ˜¯ä¸¤ç§ä¸åŒçš„å¹¶å‘è®¿é—®ç­–ç•¥ï¼Œç”¨äºå¤„ç†é›†åˆåœ¨è¿­ä»£è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹çš„æƒ…å†µã€‚

**fail-fastæœºåˆ¶**ï¼š

+ **åŸç†**ï¼šåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡`modCount`ï¼ˆä¿®æ”¹è®¡æ•°å™¨ï¼‰æ£€æµ‹é›†åˆæ˜¯å¦è¢«ä¿®æ”¹
+ **è¡Œä¸º**ï¼šå¦‚æœåœ¨è¿­ä»£è¿‡ç¨‹ä¸­é›†åˆç»“æ„è¢«ä¿®æ”¹ï¼ˆå¦‚æ·»åŠ ã€åˆ é™¤å…ƒç´ ï¼‰ï¼Œä¼šæŠ›å‡º`ConcurrentModificationException`å¼‚å¸¸
+ **å®ç°é›†åˆ**ï¼š`ArrayList`ã€`HashMap`ã€`HashSet`ç­‰æ™®é€šé›†åˆç±»
+ **ä¼˜ç‚¹**ï¼šå¿«é€Ÿå¤±è´¥ï¼Œèƒ½å¤ŸåŠæ—¶å‘ç°å¹¶å‘ä¿®æ”¹é—®é¢˜
+ **ç¼ºç‚¹**ï¼šåœ¨å•çº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœåœ¨è¿­ä»£å™¨å¤–éƒ¨ä¿®æ”¹é›†åˆä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸
+ **æ³¨æ„äº‹é¡¹**ï¼š`Iterator`çš„`remove()`æ–¹æ³•ä¿®æ”¹ä¸ä¼šè§¦å‘å¼‚å¸¸ï¼Œå› ä¸ºå®ƒä¼šåŒæ—¶æ›´æ–°`expectedModCount`å’Œ`modCount`

**fail-safeæœºåˆ¶**ï¼š

+ **åŸç†**ï¼šè¿­ä»£è¿‡ç¨‹ä¸­åŸºäºé›†åˆçš„å¿«ç…§ï¼ˆå‰¯æœ¬ï¼‰è¿›è¡Œæ“ä½œï¼Œä¸ç›´æ¥è®¿é—®åŸé›†åˆ
+ **è¡Œä¸º**ï¼šå³ä½¿é›†åˆåœ¨è¿­ä»£è¿‡ç¨‹ä¸­è¢«ä¿®æ”¹ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å¯èƒ½è¯»å–åˆ°çš„æ˜¯æ—§æ•°æ®
+ **å®ç°é›†åˆ**ï¼š`CopyOnWriteArrayList`ã€`ConcurrentHashMap`ç­‰å¹¶å‘é›†åˆç±»
+ **ä¼˜ç‚¹**ï¼šè¿­ä»£è¿‡ç¨‹ä¸­å¯ä»¥å®‰å…¨åœ°ä¿®æ”¹é›†åˆï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸
+ **ç¼ºç‚¹**ï¼šå¯èƒ½è¯»å–åˆ°è¿‡æœŸæ•°æ®ï¼Œå†…å­˜å¼€é”€è¾ƒå¤§

**ä¸»è¦åŒºåˆ«**ï¼š

1. **å¼‚å¸¸æŠ›å‡º**ï¼šfail-fastä¼šæŠ›å‡º`ConcurrentModificationException`å¼‚å¸¸ï¼Œfail-safeä¸ä¼š
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šfail-fastä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆä¸å…è®¸å¹¶å‘ä¿®æ”¹ï¼‰ï¼Œfail-safeå¯èƒ½è¯»å–åˆ°æ—§æ•°æ®
3. **å†…å­˜å¼€é”€**ï¼šfail-fastå†…å­˜å¼€é”€å°ï¼Œfail-safeå†…å­˜å¼€é”€å¤§ï¼ˆéœ€è¦å¤åˆ¶é›†åˆï¼‰
4. **é€‚ç”¨åœºæ™¯**ï¼šfail-fasté€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒï¼Œfail-safeé€‚ç”¨äºå¹¶å‘ç¯å¢ƒ

**ä»£ç ç¤ºä¾‹**ï¼š

```java
// fail-fastç¤ºä¾‹
List<String> list = new ArrayList<>(Arrays.asList("A", "B", "C"));
Iterator<String> iterator = list.iterator();
while (iterator.hasNext()) {
    String element = iterator.next();
    // ä»¥ä¸‹æ“ä½œä¼šæŠ›å‡ºConcurrentModificationException
    list.remove(element);
    // åº”è¯¥ä½¿ç”¨è¿­ä»£å™¨çš„removeæ–¹æ³•ï¼šiterator.remove();
}

// fail-safeç¤ºä¾‹
List<String> safeList = new CopyOnWriteArrayList<>(Arrays.asList("A", "B", "C"));
for (String element : safeList) {
    // å¯ä»¥å®‰å…¨åœ°ä¿®æ”¹é›†åˆï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸
    safeList.add("D");
}
```

## é¢è¯•æ¨¡æ‹Ÿé¢˜

### è®¾è®¡ä¸€ä¸ªLRUç¼“å­˜

**é—®é¢˜**ï¼šè¯·è®¾è®¡å¹¶å®ç°ä¸€ä¸ª`LRU`ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ç¼“å­˜æœºåˆ¶ï¼Œè¦æ±‚`get`å’Œ`put`æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯`O(1)`ã€‚

**åˆ†æ**ï¼š

LRUç¼“å­˜éœ€è¦æ”¯æŒå¿«é€ŸæŸ¥æ‰¾å’Œç»´æŠ¤è®¿é—®é¡ºåºï¼Œå¯ä»¥ç»“åˆ`HashMap`å’ŒåŒå‘é“¾è¡¨å®ç°ï¼š

+ `HashMap`ç”¨äº`O(1)`æ—¶é—´å¤æ‚åº¦çš„æŸ¥æ‰¾
+ åŒå‘é“¾è¡¨ç”¨äºç»´æŠ¤è®¿é—®é¡ºåºï¼Œæœ€è¿‘ä½¿ç”¨çš„æ”¾åœ¨é“¾è¡¨å¤´éƒ¨

**è§£ç­”**ï¼š

```java
public class LRUCache<K, V> {
    // å®šä¹‰åŒå‘é“¾è¡¨èŠ‚ç‚¹
    private class Node {
        K key;
        V value;
        Node prev;
        Node next;
        
        public Node(K key, V value) {
            this.key = key;
            this.value = value;
        }
    }
    
    private final int capacity; // ç¼“å­˜å®¹é‡
    private final Map<K, Node> cache; // å­˜å‚¨é”®åˆ°èŠ‚ç‚¹çš„æ˜ å°„
    private Node head; // è™šæ‹Ÿå¤´èŠ‚ç‚¹
    private Node tail; // è™šæ‹Ÿå°¾èŠ‚ç‚¹
    
    public LRUCache(int capacity) {
        this.capacity = capacity;
        this.cache = new HashMap<>(capacity);
        // åˆå§‹åŒ–è™šæ‹Ÿå¤´å°¾èŠ‚ç‚¹
        this.head = new Node(null, null);
        this.tail = new Node(null, null);
        head.next = tail;
        tail.prev = head;
    }
    
    // è·å–ç¼“å­˜ä¸­çš„å€¼
    public V get(K key) {
        Node node = cache.get(key);
        if (node == null) {
            return null; // é”®ä¸å­˜åœ¨
        }
        // å°†è®¿é—®çš„èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨ï¼ˆæ ‡è®°ä¸ºæœ€è¿‘ä½¿ç”¨ï¼‰
        moveToHead(node);
        return node.value;
    }
    
    // æ·»åŠ ç¼“å­˜é¡¹
    public void put(K key, V value) {
        Node node = cache.get(key);
        
        if (node == null) {
            // åˆ›å»ºæ–°èŠ‚ç‚¹
            Node newNode = new Node(key, value);
            cache.put(key, newNode);
            addToHead(newNode); // æ·»åŠ åˆ°é“¾è¡¨å¤´éƒ¨
            
            // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå®¹é‡
            if (cache.size() > capacity) {
                // ç§»é™¤é“¾è¡¨å°¾éƒ¨èŠ‚ç‚¹ï¼ˆæœ€ä¹…æœªä½¿ç”¨ï¼‰
                Node tail = removeTail();
                cache.remove(tail.key);
            }
        } else {
            // æ›´æ–°ç°æœ‰èŠ‚ç‚¹çš„å€¼
            node.value = value;
            moveToHead(node); // ç§»åˆ°é“¾è¡¨å¤´éƒ¨
        }
    }
    
    // å°†èŠ‚ç‚¹æ·»åŠ åˆ°é“¾è¡¨å¤´éƒ¨
    private void addToHead(Node node) {
        node.prev = head;
        node.next = head.next;
        head.next.prev = node;
        head.next = node;
    }
    
    // ä»é“¾è¡¨ä¸­ç§»é™¤èŠ‚ç‚¹
    private void removeNode(Node node) {
        node.prev.next = node.next;
        node.next.prev = node.prev;
    }
    
    // å°†èŠ‚ç‚¹ç§»åˆ°é“¾è¡¨å¤´éƒ¨
    private void moveToHead(Node node) {
        removeNode(node);
        addToHead(node);
    }
    
    // ç§»é™¤å¹¶è¿”å›é“¾è¡¨å°¾éƒ¨èŠ‚ç‚¹
    private Node removeTail() {
        Node res = tail.prev;
        removeNode(res);
        return res;
    }
    
    // æµ‹è¯•æ–¹æ³•
    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder();
        sb.append("LRUCache[capacity=").append(capacity).append(", size=").append(cache.size()).append(", items=[");
        Node current = head.next;
        while (current != tail) {
            sb.append(current.key).append("=").append(current.value);
            current = current.next;
            if (current != tail) {
                sb.append(", ");
            }
        }
        sb.append("]]");
        return sb.toString();
    }
    
    // ä¸»æ–¹æ³•æ¼”ç¤º
    public static void main(String[] args) {
        LRUCache<String, Integer> cache = new LRUCache<>(3);
        
        cache.put("A", 1);
        cache.put("B", 2);
        cache.put("C", 3);
        System.out.println("åˆå§‹ç¼“å­˜: " + cache); // åº”è¯¥åŒ…å« A=1, B=2, C=3
        
        cache.get("A"); // è®¿é—®Aï¼Œå°†å…¶ç§»åˆ°æœ€è¿‘ä½¿ç”¨
        System.out.println("è®¿é—®Aå: " + cache); // é¡ºåºåº”è¯¥å˜ä¸º B=2, C=3, A=1
        
        cache.put("D", 4); // æ·»åŠ Dï¼Œåº”è¯¥æ·˜æ±°B
        System.out.println("æ·»åŠ Då: " + cache); // åº”è¯¥åŒ…å« C=3, A=1, D=4
        
        cache.get("B"); // å°è¯•è®¿é—®Bï¼Œåº”è¯¥è¿”å›null
        System.out.println("è®¿é—®Bå: " + cache);
        
        cache.put("C", 30); // æ›´æ–°Cçš„å€¼
        System.out.println("æ›´æ–°Cå: " + cache); // Cçš„å€¼åº”è¯¥æ›´æ–°ä¸º30ï¼Œå¹¶ä¸”ç§»åˆ°æœ€è¿‘ä½¿ç”¨
    }
}
```

è¿™ä¸ªå®ç°æ»¡è¶³äº†è¦æ±‚çš„O(1)æ—¶é—´å¤æ‚åº¦ï¼ŒåŒæ—¶èƒ½å¤Ÿæœ‰æ•ˆåœ°ç®¡ç†ç¼“å­˜å¤§å°å’Œè®¿é—®é¡ºåºã€‚

### ç»Ÿè®¡å­—ç¬¦ä¸²ä¸­å­—ç¬¦å‡ºç°é¢‘ç‡

**é—®é¢˜**ï¼šç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œç»Ÿè®¡å…¶ä¸­æ¯ä¸ªå­—ç¬¦å‡ºç°çš„é¢‘ç‡ï¼Œå¹¶æŒ‰ç…§é¢‘ç‡ä»é«˜åˆ°ä½æ’åºè¾“å‡ºã€‚

**åˆ†æ**ï¼š

è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š

1. ä½¿ç”¨`HashMap`ç»Ÿè®¡æ¯ä¸ªå­—ç¬¦çš„å‡ºç°æ¬¡æ•°
2. å°†å­—ç¬¦å’Œé¢‘ç‡çš„æ˜ å°„è½¬æ¢ä¸ºåˆ—è¡¨æˆ–é›†åˆ
3. æŒ‰ç…§é¢‘ç‡ä»é«˜åˆ°ä½æ’åº
4. è¾“å‡ºæ’åºç»“æœ

**è§£ç­”**ï¼š

```java
import java.util.*;
import java.util.stream.*;

public class CharacterFrequencyCounter {
    // æ–¹æ³•1ï¼šä½¿ç”¨HashMapå’ŒCollections.sort
    public static Map<Character, Integer> countFrequency1(String input) {
        if (input == null || input.isEmpty()) {
            return Collections.emptyMap();
        }
        
        // ç»Ÿè®¡å­—ç¬¦é¢‘ç‡
        Map<Character, Integer> frequencyMap = new HashMap<>();
        for (char c : input.toCharArray()) {
            frequencyMap.put(c, frequencyMap.getOrDefault(c, 0) + 1);
        }
        
        // å°†Mapè½¬æ¢ä¸ºListè¿›è¡Œæ’åº
        List<Map.Entry<Character, Integer>> entryList = new ArrayList<>(frequencyMap.entrySet());
        entryList.sort(Map.Entry.<Character, Integer>comparingByValue().reversed());
        
        // åˆ›å»ºæœ‰åºçš„LinkedHashMapæ¥ä¿æŒæ’åºç»“æœ
        Map<Character, Integer> sortedMap = new LinkedHashMap<>();
        for (Map.Entry<Character, Integer> entry : entryList) {
            sortedMap.put(entry.getKey(), entry.getValue());
        }
        
        return sortedMap;
    }
    
    // æ–¹æ³•2ï¼šä½¿ç”¨Stream API
    public static Map<Character, Integer> countFrequency2(String input) {
        if (input == null || input.isEmpty()) {
            return Collections.emptyMap();
        }
        
        return input.chars()
                .mapToObj(c -> (char) c)
                .collect(Collectors.groupingBy(c -> c, Collectors.summingInt(c -> 1)))
                .entrySet().stream()
                .sorted(Map.Entry.<Character, Integer>comparingByValue().reversed())
                .collect(Collectors.toMap(
                        Map.Entry::getKey,
                        Map.Entry::getValue,
                        (oldValue, newValue) -> oldValue,
                        LinkedHashMap::new
                ));
    }
    
    // æ–¹æ³•3ï¼šå¤„ç†Unicodeå­—ç¬¦ï¼Œä½¿ç”¨codePoint
    public static Map<String, Integer> countFrequencyUnicode(String input) {
        if (input == null || input.isEmpty()) {
            return Collections.emptyMap();
        }
        
        Map<String, Integer> frequencyMap = new HashMap<>();
        
        // ä½¿ç”¨codePointæ–¹æ³•å¤„ç†Unicodeå­—ç¬¦
        int i = 0;
        while (i < input.length()) {
            int codePoint = input.codePointAt(i);
            String character = new String(Character.toChars(codePoint));
            frequencyMap.put(character, frequencyMap.getOrDefault(character, 0) + 1);
            i += Character.charCount(codePoint);
        }
        
        // æ’åºå¹¶åˆ›å»ºæœ‰åºMap
        List<Map.Entry<String, Integer>> entryList = new ArrayList<>(frequencyMap.entrySet());
        entryList.sort(Map.Entry.<String, Integer>comparingByValue().reversed());
        
        Map<String, Integer> sortedMap = new LinkedHashMap<>();
        for (Map.Entry<String, Integer> entry : entryList) {
            sortedMap.put(entry.getKey(), entry.getValue());
        }
        
        return sortedMap;
    }
    
    // æ‰“å°ç»“æœçš„è¾…åŠ©æ–¹æ³•
    public static void printFrequencyMap(Map<?, Integer> frequencyMap) {
        System.out.println("å­—ç¬¦é¢‘ç‡ç»Ÿè®¡ç»“æœï¼ˆæŒ‰é¢‘ç‡é™åºï¼‰ï¼š");
        frequencyMap.forEach((key, value) -> {
            System.out.printf("'%s': %d\n", key, value);
        });
    }
    
    public static void main(String[] args) {
        // æµ‹è¯•åŸºæœ¬ASCIIå­—ç¬¦
        String testString = "hello world! programming is fun. java collection framework.";
        System.out.println("=== æµ‹è¯•åŸºæœ¬ASCIIå­—ç¬¦ ===");
        System.out.println("è¾“å…¥å­—ç¬¦ä¸²: " + testString);
        
        System.out.println("\næ–¹æ³•1ç»“æœï¼š");
        Map<Character, Integer> result1 = countFrequency1(testString);
        printFrequencyMap(result1);
        
        System.out.println("\næ–¹æ³•2ç»“æœï¼š");
        Map<Character, Integer> result2 = countFrequency2(testString);
        printFrequencyMap(result2);
        
        // æµ‹è¯•Unicodeå­—ç¬¦
        String unicodeString = "ä½ å¥½ï¼Œä¸–ç•Œï¼Javaé›†åˆæ¡†æ¶å¾ˆæœ‰è¶£ã€‚ğŸ˜ŠğŸ˜‚ğŸ‘";
        System.out.println("\n=== æµ‹è¯•Unicodeå­—ç¬¦ ===");
        System.out.println("è¾“å…¥å­—ç¬¦ä¸²: " + unicodeString);
        
        Map<String, Integer> unicodeResult = countFrequencyUnicode(unicodeString);
        printFrequencyMap(unicodeResult);
    }
}
```

### å®ç°çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼

**é—®é¢˜**ï¼šè¯·å®ç°å‡ ç§çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ï¼Œå¹¶åˆ†æå®ƒä»¬çš„ä¼˜ç¼ºç‚¹ã€‚

**åˆ†æ**ï¼š

å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œå„æœ‰ä¼˜ç¼ºç‚¹ã€‚

**è§£ç­”**ï¼š

```java
import java.util.concurrent.ConcurrentHashMap;
import java.util.function.Supplier;

// 1. é¥¿æ±‰å¼ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
class EagerSingleton {
    // ç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹
    private static final EagerSingleton INSTANCE = new EagerSingleton();
    
    // ç§æœ‰æ„é€ å‡½æ•°é˜²æ­¢å¤–éƒ¨å®ä¾‹åŒ–
    private EagerSingleton() {
        // é˜²æ­¢é€šè¿‡åå°„åˆ›å»ºå¤šä¸ªå®ä¾‹
        if (INSTANCE != null) {
            throw new RuntimeException("è¯·ä½¿ç”¨getInstance()æ–¹æ³•è·å–å®ä¾‹");
        }
    }
    
    public static EagerSingleton getInstance() {
        return INSTANCE;
    }
}

// 2. æ‡’æ±‰å¼ï¼ˆä½¿ç”¨synchronizedå®ç°çº¿ç¨‹å®‰å…¨ï¼‰
class LazySingleton {
    private static LazySingleton instance;
    
    private LazySingleton() {
        // é˜²æ­¢é€šè¿‡åå°„åˆ›å»ºå¤šä¸ªå®ä¾‹
        if (instance != null) {
            throw new RuntimeException("è¯·ä½¿ç”¨getInstance()æ–¹æ³•è·å–å®ä¾‹");
        }
    }
    
    // æ–¹æ³•åŒæ­¥ï¼Œçº¿ç¨‹å®‰å…¨ä½†æ€§èƒ½è¾ƒå·®
    public static synchronized LazySingleton getInstance() {
        if (instance == null) {
            instance = new LazySingleton();
        }
        return instance;
    }
}

// 3. åŒé‡æ£€æŸ¥é”å®šï¼ˆDouble-Checked Lockingï¼‰
class DCLSingleton {
    // volatileå…³é”®å­—é˜²æ­¢æŒ‡ä»¤é‡æ’åº
    private static volatile DCLSingleton instance;
    
    private DCLSingleton() {
        // é˜²æ­¢é€šè¿‡åå°„åˆ›å»ºå¤šä¸ªå®ä¾‹
        if (instance != null) {
            throw new RuntimeException("è¯·ä½¿ç”¨getInstance()æ–¹æ³•è·å–å®ä¾‹");
        }
    }
    
    public static DCLSingleton getInstance() {
        // ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼Œé¿å…ä¸å¿…è¦çš„åŒæ­¥
        if (instance == null) {
            synchronized (DCLSingleton.class) {
                // ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼Œç¡®ä¿åªåˆ›å»ºä¸€ä¸ªå®ä¾‹
                if (instance == null) {
                    instance = new DCLSingleton();
                }
            }
        }
        return instance;
    }
}

// 4. é™æ€å†…éƒ¨ç±»å®ç°ï¼ˆInitialization-on-demand holder idiomï¼‰
class HolderSingleton {
    // é™æ€å†…éƒ¨ç±»
    private static class SingletonHolder {
        private static final HolderSingleton INSTANCE = new HolderSingleton();
    }
    
    private HolderSingleton() {
        // é˜²æ­¢é€šè¿‡åå°„åˆ›å»ºå¤šä¸ªå®ä¾‹
        if (SingletonHolder.INSTANCE != null) {
            throw new RuntimeException("è¯·ä½¿ç”¨getInstance()æ–¹æ³•è·å–å®ä¾‹");
        }
    }
    
    public static HolderSingleton getInstance() {
        return SingletonHolder.INSTANCE;
    }
}

// 5. æšä¸¾å®ç°ï¼ˆEnum Singletonï¼‰
enum EnumSingleton {
    INSTANCE;
    
    // æšä¸¾æ„é€ å‡½æ•°é»˜è®¤æ˜¯ç§æœ‰çš„
    EnumSingleton() {
        // åˆå§‹åŒ–ä»£ç 
    }
    
    // æ·»åŠ ä¸šåŠ¡æ–¹æ³•
    public void businessMethod() {
        System.out.println("æšä¸¾å•ä¾‹çš„ä¸šåŠ¡æ–¹æ³•");
    }
}

// 6. ä½¿ç”¨ConcurrentHashMapå®ç°æ³¨å†Œè¡¨å¼å•ä¾‹
class ConcurrentSingletonRegistry {
    private static final ConcurrentHashMap<String, Object> INSTANCES = new ConcurrentHashMap<>();
    
    // ç§æœ‰æ„é€ å‡½æ•°
    private ConcurrentSingletonRegistry() {}
    
    // è·å–æŒ‡å®šç±»å‹çš„å•ä¾‹
    @SuppressWarnings("unchecked")
    public static <T> T getInstance(String key, Supplier<T> creator) {
        return (T) INSTANCES.computeIfAbsent(key, k -> creator.get());
    }
}

// æµ‹è¯•ç±»
public class SingletonTest {
    public static void main(String[] args) {
        // æµ‹è¯•é¥¿æ±‰å¼
        EagerSingleton eager1 = EagerSingleton.getInstance();
        EagerSingleton eager2 = EagerSingleton.getInstance();
        System.out.println("é¥¿æ±‰å¼å•ä¾‹ç›¸åŒ: " + (eager1 == eager2));
        
        // æµ‹è¯•æ‡’æ±‰å¼
        LazySingleton lazy1 = LazySingleton.getInstance();
        LazySingleton lazy2 = LazySingleton.getInstance();
        System.out.println("æ‡’æ±‰å¼å•ä¾‹ç›¸åŒ: " + (lazy1 == lazy2));
        
        // æµ‹è¯•åŒé‡æ£€æŸ¥é”å®š
        DCLSingleton dcl1 = DCLSingleton.getInstance();
        DCLSingleton dcl2 = DCLSingleton.getInstance();
        System.out.println("DCLå•ä¾‹ç›¸åŒ: " + (dcl1 == dcl2));
        
        // æµ‹è¯•é™æ€å†…éƒ¨ç±»
        HolderSingleton holder1 = HolderSingleton.getInstance();
        HolderSingleton holder2 = HolderSingleton.getInstance();
        System.out.println("é™æ€å†…éƒ¨ç±»å•ä¾‹ç›¸åŒ: " + (holder1 == holder2));
        
        // æµ‹è¯•æšä¸¾å•ä¾‹
        EnumSingleton enum1 = EnumSingleton.INSTANCE;
        EnumSingleton enum2 = EnumSingleton.INSTANCE;
        System.out.println("æšä¸¾å•ä¾‹ç›¸åŒ: " + (enum1 == enum2));
        enum1.businessMethod();
        
        // æµ‹è¯•ConcurrentHashMapæ³¨å†Œè¡¨
        TestClass test1 = ConcurrentSingletonRegistry.getInstance("test", TestClass::new);
        TestClass test2 = ConcurrentSingletonRegistry.getInstance("test", TestClass::new);
        System.out.println("ConcurrentHashMapæ³¨å†Œè¡¨å•ä¾‹ç›¸åŒ: " + (test1 == test2));
    }
    
    // æµ‹è¯•ç”¨çš„ç±»
    static class TestClass {
        // ç±»å†…å®¹
    }
}

/* å„å®ç°æ–¹å¼çš„ä¼˜ç¼ºç‚¹åˆ†æï¼š

1. é¥¿æ±‰å¼ï¼š
   - ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»å¯¹çº¿ç¨‹å®‰å…¨
   - ç¼ºç‚¹ï¼šç±»åŠ è½½æ—¶å°±åˆ›å»ºå®ä¾‹ï¼Œå¯èƒ½é€ æˆèµ„æºæµªè´¹

2. æ‡’æ±‰å¼ï¼ˆsynchronizedæ–¹æ³•ï¼‰ï¼š
   - ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œå»¶è¿ŸåŠ è½½
   - ç¼ºç‚¹ï¼šæ€§èƒ½è¾ƒå·®ï¼Œæ¯æ¬¡è·å–å®ä¾‹éƒ½éœ€è¦åŒæ­¥

3. åŒé‡æ£€æŸ¥é”å®šï¼š
   - ä¼˜ç‚¹ï¼šå»¶è¿ŸåŠ è½½ï¼Œæ€§èƒ½è¾ƒå¥½ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡åˆ›å»ºå®ä¾‹æ—¶éœ€è¦åŒæ­¥
   - ç¼ºç‚¹ï¼šå®ç°è¾ƒå¤æ‚ï¼Œéœ€è¦ä½¿ç”¨volatileå…³é”®å­—é˜²æ­¢æŒ‡ä»¤é‡æ’åº

4. é™æ€å†…éƒ¨ç±»ï¼š
   - ä¼˜ç‚¹ï¼šå»¶è¿ŸåŠ è½½ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ€§èƒ½å¥½
   - ç¼ºç‚¹ï¼šå®ç°ç¨å¤æ‚

5. æšä¸¾å®ç°ï¼š
   - ä¼˜ç‚¹ï¼šå®ç°æœ€ç®€å•ï¼Œç»å¯¹çº¿ç¨‹å®‰å…¨ï¼Œé˜²æ­¢åºåˆ—åŒ–å’Œåå°„æ”»å‡»
   - ç¼ºç‚¹ï¼šä¸èƒ½å»¶è¿ŸåŠ è½½ï¼Œç±»åŠ è½½æ—¶å°±åˆå§‹åŒ–

6. ConcurrentHashMapæ³¨å†Œè¡¨ï¼š
   - ä¼˜ç‚¹ï¼šæ”¯æŒå¤šç±»å‹å•ä¾‹æ³¨å†Œï¼Œçº¿ç¨‹å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½
   - ç¼ºç‚¹ï¼šå®ç°è¾ƒå¤æ‚ï¼Œéœ€è¦é¢å¤–çš„é”®æ¥æ ‡è¯†ä¸åŒç±»å‹çš„å•ä¾‹
*/
```

## é¢è¯•åŠ åˆ†è¦ç‚¹

### ç‰ˆæœ¬å·®å¼‚

1. **JDK 7 vs JDK 8çš„**`HashMap`**åŒºåˆ«**ï¼š
    + å­˜å‚¨ç»“æ„ï¼š7ç”¨æ•°ç»„+é“¾è¡¨ï¼Œ8ç”¨æ•°ç»„+é“¾è¡¨/çº¢é»‘æ ‘
    + é“¾è¡¨æ’å…¥ï¼š7ç”¨å¤´æ’æ³•ï¼Œ8ç”¨å°¾æ’æ³•
    + æ‰©å®¹æœºåˆ¶ï¼š8ä¼˜åŒ–äº†å“ˆå¸Œè®¡ç®—ï¼Œé¿å…é“¾è¡¨æˆç¯é—®é¢˜
    + æ€§èƒ½ï¼š8åœ¨å“ˆå¸Œå†²çªä¸¥é‡æ—¶æ€§èƒ½æ›´å¥½ï¼ˆO(log n) vs O(n)ï¼‰
2. **JDK 7 vs JDK 8çš„**`ConcurrentHashMap`**åŒºåˆ«**ï¼š
    + é”æœºåˆ¶ï¼š7ç”¨åˆ†æ®µé”ï¼ˆ`Segment`ï¼‰ï¼Œ8ç”¨`CAS`+`synchronized`ä¼˜åŒ–
    + å¹¶å‘åº¦ï¼š7å—`Segment`æ•°é‡é™åˆ¶ï¼Œ`8`ç†è®ºä¸Šç­‰äºæ•°ç»„é•¿åº¦
    + æ€§èƒ½ï¼š`8`åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ€§èƒ½æ›´å¥½ï¼ˆO(log n) vs O(n)ï¼‰

### æ€§èƒ½åˆ†æ

1. **æ—¶é—´å¤æ‚åº¦åˆ†æ**ï¼š
    + `ArrayList`éšæœºè®¿é—®ï¼š`O(1)`
    + `LinkedList`éšæœºè®¿é—®ï¼š`O(n)`
    + `HashMap`æŸ¥æ‰¾/æ·»åŠ /åˆ é™¤ï¼šå¹³å‡`O(1)`ï¼Œæœ€å`O(log n)`ï¼ˆçº¢é»‘æ ‘ï¼‰
    + `TreeMap`æŸ¥æ‰¾/æ·»åŠ /åˆ é™¤ï¼š`O(log n)`
    + `HashSet`æ·»åŠ /åˆ é™¤/æŸ¥æ‰¾ï¼šå¹³å‡`O(1)`ï¼Œæœ€å`O(log n)`
2. **ç©ºé—´å¤æ‚åº¦åˆ†æ**ï¼š
    + `ArrayList`ï¼š`O(n)`ï¼Œä½†å¯èƒ½æœ‰é¢å¤–çš„é¢„ç•™ç©ºé—´
    + `LinkedList`ï¼š`O(n)`ï¼Œé¢å¤–å­˜å‚¨å‰åå¼•ç”¨
    + `HashMap`ï¼š`O(n)`ï¼Œè´Ÿè½½å› å­å½±å“ç©ºé—´åˆ©ç”¨ç‡
    + `ConcurrentHashMap`ï¼š`O(n)`ï¼Œé¢å¤–çš„å¹¶å‘æ§åˆ¶å¼€é”€
    + `CopyOnWriteArrayList`ï¼šå†™æ“ä½œæ—¶`O(n)`ï¼Œéœ€è¦å¤åˆ¶æ•´ä¸ªæ•°ç»„

### æºç ç†è§£

1. `HashMap`**çš„**`resize()`**æ–¹æ³•**ï¼šç†è§£æ‰©å®¹è¿‡ç¨‹å’Œé‡å“ˆå¸Œç®—æ³•
2. `ConcurrentHashMap`**çš„**`putVal()`**æ–¹æ³•**ï¼šç†è§£ç»†ç²’åº¦é”å®ç°
3. `ArrayList`**çš„æ‰©å®¹æœºåˆ¶**ï¼šç†è§£`grow()`æ–¹æ³•å’Œ`Arrays.copyOf()`çš„ä½¿ç”¨
4. `LinkedList`**çš„é“¾è¡¨æ“ä½œ**ï¼šç†è§£èŠ‚ç‚¹æ·»åŠ ã€åˆ é™¤çš„å®ç°

### å®æˆ˜ç»éªŒ

1. **é›†åˆåˆå§‹åŒ–å®¹é‡**ï¼šæ ¹æ®é¢„æœŸæ•°æ®é‡è®¾ç½®åˆé€‚çš„åˆå§‹å®¹é‡
2. **çº¿ç¨‹å®‰å…¨é€‰æ‹©**ï¼šæ ¹æ®å¹¶å‘åœºæ™¯é€‰æ‹©åˆé€‚çš„çº¿ç¨‹å®‰å…¨é›†åˆ
3. **é¿å…æ€§èƒ½é™·é˜±**ï¼š
    + é¿å…åœ¨å¾ªç¯ä¸­ä½¿ç”¨`ArrayList`çš„`remove()`æ–¹æ³•ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´å…ƒç´ ç§»åŠ¨
    + é¿å…åˆ›å»ºå¤§é‡ä¸´æ—¶é›†åˆå¯¹è±¡ï¼ŒåŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„å¼•ç”¨
    + æ­£ç¡®ä½¿ç”¨è¿­ä»£å™¨ï¼Œé¿å…åœ¨éå†ä¸­ä¿®æ”¹é›†åˆ
4. **å†…å­˜ä¼˜åŒ–**ï¼š
    + ä½¿ç”¨åŸå§‹ç±»å‹é›†åˆï¼ˆå¦‚`IntArrayList`ï¼‰å‡å°‘è£…ç®±å¼€é”€
    + å¯¹äºå¤§é›†åˆï¼Œè€ƒè™‘ä½¿ç”¨å¹¶è¡Œæµå¤„ç†
    + åŠæ—¶æ¸…ç†ä¸å†ä½¿ç”¨çš„é›†åˆå¼•ç”¨

### æ‰©å±•æ€è€ƒ

1. **è‡ªå®šä¹‰é›†åˆå®ç°**ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„é«˜æ€§èƒ½é›†åˆ
2. **é›†åˆæ¡†æ¶è®¾è®¡**ï¼šç†è§£Javaé›†åˆæ¡†æ¶çš„è®¾è®¡ç†å¿µå’Œæ¥å£å±‚æ¬¡
3. **æ›¿ä»£æ–¹æ¡ˆæ¯”è¾ƒ**ï¼šä¸å…¶ä»–è¯­è¨€é›†åˆæ¡†æ¶çš„æ¯”è¾ƒï¼ˆå¦‚`C++ STL`ã€Pythoné›†åˆï¼‰
4. **æ–°ç‰¹æ€§å…³æ³¨**ï¼š`Java 9+`é›†åˆå·¥å‚æ–¹æ³•ã€`Java 16+`å‘é‡APIç­‰æ–°ç‰¹æ€§

## é¢è¯•å‡†å¤‡æ¸…å•

### å¿…èƒŒçŸ¥è¯†ç‚¹

1. **æ ¸å¿ƒæ¥å£å±‚æ¬¡ç»“æ„**ï¼š`Collection`ã€`Map`åŠå…¶å­æ¥å£
2. **ä¸»è¦å®ç°ç±»ç‰¹ç‚¹**ï¼š`ArrayList`ã€`LinkedList`ã€`HashMap`ã€`TreeMap`ç­‰
3. **å¹¶å‘é›†åˆç‰¹æ€§**ï¼š`ConcurrentHashMap`ã€`CopyOnWriteArrayList`ã€`BlockingQueue`ç­‰
4. `equals/hashCode`**å¥‘çº¦**ï¼šæ­£ç¡®å®ç°çš„åŸåˆ™å’Œç¤ºä¾‹
5. **å¸¸è§è®¾è®¡æ¨¡å¼**ï¼šå•ä¾‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼ï¼ˆé›†åˆæ¡†æ¶ä¸­çš„åº”ç”¨ï¼‰

### å®æˆ˜æŠ€èƒ½

1. **é›†åˆæ€§èƒ½åˆ†æ**ï¼šèƒ½å¤Ÿåˆ†æä¸åŒé›†åˆæ“ä½œçš„æ—¶é—´å’Œç©ºé—´å¤æ‚åº¦
2. **çº¿ç¨‹å®‰å…¨é—®é¢˜æ’æŸ¥**ï¼šèƒ½å¤Ÿè¯†åˆ«å’Œè§£å†³é›†åˆåœ¨å¹¶å‘ç¯å¢ƒä¸­çš„é—®é¢˜
3. **ä»£ç ä¼˜åŒ–èƒ½åŠ›**ï¼šèƒ½å¤Ÿä¼˜åŒ–é›†åˆç›¸å…³ä»£ç çš„æ€§èƒ½
4. **è®¾è®¡èƒ½åŠ›**ï¼šèƒ½å¤Ÿæ ¹æ®éœ€æ±‚è®¾è®¡åˆé€‚çš„æ•°æ®ç»“æ„å’Œé›†åˆé€‰æ‹©æ–¹æ¡ˆ

### æ€ç»´è®­ç»ƒ

1. **ç±»æ¯”æ€ç»´**ï¼šå°†é›†åˆç±»ä¸ç°å®ä¸–ç•Œçš„å®¹å™¨è¿›è¡Œç±»æ¯”
2. **å¯¹æ¯”åˆ†æ**ï¼šèƒ½å¤Ÿå¯¹æ¯”ä¸åŒé›†åˆç±»çš„ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯
3. **åŸç†è§£æ**ï¼šèƒ½å¤Ÿæ·±å…¥è§£é‡Šé›†åˆç±»çš„åº•å±‚å®ç°åŸç†
4. **åœºæ™¯åº”ç”¨**ï¼šèƒ½å¤Ÿå°†é›†åˆçŸ¥è¯†åº”ç”¨åˆ°å®é™…ä¸šåŠ¡åœºæ™¯ä¸­

## å°ç»“

Javaé›†åˆæ¡†æ¶æ˜¯Javaå¼€å‘ä¸­æœ€å¸¸ç”¨çš„APIä¹‹ä¸€ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­çš„é«˜é¢‘çŸ¥è¯†ç‚¹ã€‚æœ¬ç« ç³»ç»Ÿæ€»ç»“äº†Javaé›†åˆæ¡†æ¶çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ã€é¢è¯•é«˜é¢‘é—®é¢˜åŠå›ç­”æŠ€å·§ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åŠ©ä½ åœ¨é¢è¯•ä¸­å–å¾—å¥½æˆç»©ã€‚

é¢è¯•ä¸­ï¼Œä¸ä»…è¦æŒæ¡é›†åˆç±»çš„åŸºæœ¬ç”¨æ³•ï¼Œæ›´è¦æ·±å…¥ç†è§£å…¶åº•å±‚å®ç°åŸç†ã€æ€§èƒ½ç‰¹æ€§å’Œé€‚ç”¨åœºæ™¯ã€‚åŒæ—¶ï¼Œç»“åˆå®é™…é¡¹ç›®ç»éªŒï¼Œèƒ½å¤Ÿçµæ´»è¿ç”¨é›†åˆæ¡†æ¶è§£å†³å®é™…é—®é¢˜ï¼Œä¹Ÿæ˜¯é¢è¯•å®˜éå¸¸çœ‹é‡çš„èƒ½åŠ›ã€‚

æœ€åï¼Œå»ºè®®é€šè¿‡å¤§é‡çš„ç¼–ç ç»ƒä¹ å’Œæºç é˜…è¯»æ¥åŠ æ·±å¯¹Javaé›†åˆæ¡†æ¶çš„ç†è§£ï¼Œè¿™æ ·åœ¨é¢è¯•ä¸­æ‰èƒ½åšåˆ°æ¸¸åˆƒæœ‰ä½™ã€‚
